<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Danh mục đầu tư - Demo LocalStorage</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
  <style>
    body {padding:20px;background:#f8f9fa}
    h1 {margin-bottom:20px;}
    table input {min-width:90px;}
  </style>
</head>
<body>
  <h1>Danh mục đầu tư</h1>
  <button id="addRow" class="btn btn-primary mb-3">➕ Thêm mã</button>
  <table class="table table-bordered table-sm align-middle">
    <thead class="table-light">
      <tr>
        <th>Mã</th>
        <th>Số lượng</th>
        <th>Giá mua</th>
        <th>Giá hiện tại</th>
        <th>Ngày vào lệnh</th>
        <th>Giá trị</th>
        <th>Lãi/Lỗ</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

<script>
const rowsEl = document.getElementById('rows');
let data = JSON.parse(localStorage.getItem('portfolio') || '[]');

function format(v){
  return Number(v||0).toLocaleString('vi-VN');
}
function render(){
  rowsEl.innerHTML = '';
  data.forEach((r,i)=>{
    const value = (r.qty*r.current);
    const profit = value - (r.qty*r.buy);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="form-control code" data-i="${i}" value="${r.code||''}"></td>
      <td><input type="number" class="form-control qty" data-i="${i}" value="${r.qty||0}"></td>
      <td><input type="number" class="form-control buy" data-i="${i}" value="${r.buy||0}"></td>
      <td><input type="number" class="form-control current" data-i="${i}" value="${r.current||0}"></td>
      <td><input type="date" class="form-control date" data-i="${i}" value="${r.date||''}"></td>
      <td>${format(value)}</td>
      <td class="${profit>=0?'text-success':'text-danger'}">${format(profit)}</td>
      <td><button class="btn btn-sm btn-danger delete" data-i="${i}">Xóa</button></td>
    `;
    rowsEl.appendChild(tr);
  });
  save();
}
function save(){
  localStorage.setItem('portfolio', JSON.stringify(data));
}
document.getElementById('addRow').onclick = ()=>{
  data.push({code:'', qty:0, buy:0, current:0, date:''});
  render();
};
rowsEl.addEventListener('input', e=>{
  const i = e.target.dataset.i;
  if(i!==undefined){
    const cls = e.target.classList[1]; // code/qty/buy/current/date
    data[i][cls] = e.target.value;
    render();
  }
});
rowsEl.addEventListener('click', e=>{
  if(e.target.classList.contains('delete')){
    data.splice(e.target.dataset.i,1);
    render();
  }
});
render();
</script>
</body>
</html>
